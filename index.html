<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Saint Thomas Attendance</title>

<style>
/* =========================
   GLOBAL
========================= */
* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: linear-gradient(#f5f5f7, #ffffff);
  color: #1c1c1e;
  margin: 0;
  padding: 24px;
  max-width: 1100px;
  margin-inline: auto;
}

/* =========================
   TYPOGRAPHY
========================= */
h1 {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 24px;
}

h3 {
  font-size: 16px;
  font-weight: 600;
  margin: 20px 0 8px;
  color: #3a3a3c;
}

/* =========================
   CARDS
========================= */
.card {
  background: white;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}

/* =========================
   INPUTS
========================= */
input, textarea, button {
  font-family: inherit;
}

input, textarea {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #d1d1d6;
  font-size: 15px;
}

input:focus, textarea:focus {
  outline: none;
  border-color: #007aff;
}

/* =========================
   BUTTONS
========================= */
button {
  padding: 12px 16px;
  border-radius: 14px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  background-color: #007aff;
  color: white;
  box-shadow: 0 6px 14px rgba(0,122,255,0.25);
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

button:hover { transform: translateY(-1px); }
button:active {
  transform: translateY(1px);
  box-shadow: 0 3px 8px rgba(0,122,255,0.25);
}

button.secondary {
  background: #28a745;
  box-shadow: 0 6px 14px rgba(40,167,69,0.25);
}

/* =========================
   MODE TOGGLE
========================= */
.mode-buttons {
  display: flex;
  gap: 6px;
  background: #e5e5ea;
  padding: 6px;
  border-radius: 999px;
  margin-bottom: 24px;
}

.mode-button {
  flex: 1;
  background: transparent;
  color: #3a3a3c;
  box-shadow: none;
}

.mode-button.active-mode {
  background: white;
  color: #007aff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* =========================
   AUTOCOMPLETE
========================= */
.autocomplete-box { position: relative; }

.suggestions {
  position: absolute;
  width: 100%;
  margin-top: 6px;
  background: white;
  border-radius: 12px;
  max-height: 180px;
  overflow-y: auto;
  box-shadow: 0 10px 25px rgba(0,0,0,0.12);
  z-index: 20;
}

.suggestion-item {
  padding: 10px 12px;
  cursor: pointer;
}

.suggestion-item:hover,
.suggestion-item.active {
  background: #f2f2f7;
}

/* =========================
   SELECTED PILLS
========================= */
.selected-pill {
  display: inline-block;
  padding: 6px 12px;
  margin: 4px;
  border-radius: 20px;
  background: #f2f2f7;
  border: 1px solid #d1d1d6;
}

.selected-pill span {
  margin-left: 8px;
  color: #ff3b30;
  cursor: pointer;
  font-weight: bold;
}

.note-box {
  width: 100%;
  margin: 6px 0 12px;
  padding: 8px;
  border-radius: 10px;
  border: 1px solid #d1d1d6;
}

/* =========================
   TABLES
========================= */
#output {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap: 16px;
  margin-top: 16px;
}

.table {
  background: white;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.06);
}

.table h3 {
  margin-top: 0;
  border-bottom: 1px solid #e5e5ea;
  padding-bottom: 8px;
}

li {
  list-style: none;
  padding: 8px 10px;
  margin: 6px 0;
  border: 1px solid #e5e5ea;
  border-radius: 8px;
  cursor: grab;
}

/* ========================= */
.hidden { display: none; }
.footer-text {
  margin-top: 40px;
  font-size: 12px;
  color: #6e6e73;
  text-align: center;
}
</style>
</head>

<body>

<h1>Saint Thomas Youth Group Attendance</h1>

<div class="mode-buttons">
  <button type="button" id="rosaryBtn" class="mode-button" onclick="setMode('rosary')">Rosary / Holy Hour</button>
  <button type="button" id="youthBtn" class="mode-button active-mode" onclick="setMode('youth')">Youth Group</button>
</div>

<div class="card">
  <h3>Present Attendees</h3>
  <div class="autocomplete-box">
    <input id="presentInput" placeholder="Type a name..." autocomplete="off">
    <div id="presentSuggestions" class="suggestions"></div>
  </div>
  <div id="presentSelected"></div>
</div>

<div id="youthFeatures">

  <div class="card">
    <h3>Core Members</h3>
    <div class="autocomplete-box">
      <input id="coreInput" placeholder="Type a core member..." autocomplete="off">
      <div id="coreSuggestions" class="suggestions"></div>
    </div>
    <div id="coreSelected"></div>
  </div>

  <div class="card">
    <h3>Groups That Must Sit Together</h3>
    <textarea id="togetherGroups"></textarea>

    <h3>Number of Tables</h3>
    <input type="number" id="numTables" min="1" value="8">

    <br><br>
    <button type="button" onclick="generateTables()">Generate Tables</button>

    <div id="output"></div>
  </div>

</div>

<div class="card">
  <h3>Attendance List</h3>
  <textarea id="copyList" rows="8"></textarea>
  <br><br>
  <button type="button" class="secondary" onclick="exportToCSV()">Export to CSV</button>
</div>

<div class="footer-text">
  Â© 2026 Saint Thomas the Apostle Youth Group Â· Raphael Ide
</div>

<script>
/* =========================
   DATA
========================= */
const allAttendees = [
  'Mara Wesolowski','Allie Choate','Bria Santoro','MariaTeresa Arena',
  'Danny Kuyrouz','Amelia Cannato','Carmine Arena','Francesco Arena',
  'Winnie McLaughlin','Caroline Lally','Luke Walsh','Flynn Walsh','James Bowman',
  'Emmie Valenzuela','Antony Marcucci','Maggie Woodard','Amelia Choate',
  'Andrew Foraker','Bella Calvo','Ben Biggins','Blake Masso','Will OBrien',
  'Bridget Gonya','Caroline Gonya','Bowman Rhinesmith','Cat Choate','Catalina Calvo',
  'Catarina Franchi','Catherine McLaughlin','Cecelia Lateo','Charbel Almacari',
  'Charlotte Keefe','Christine Cheely','Sammy Biggins','Clare Walsh','Cormac Doyle',
  'Dermot O\'Boyle','Dottie Mahoney','Kaylee Cumming','Elizabeth Brown','Ella Hill',
  'Emilia Parrella','Emily Rameaka','Grace Ahearn','Grace Finnegan',
  'Grace Garvey','Grace Lynch','Graham Evans','Nicholas Arico','Grace Nohrden','Griffin Masso',
  'Hannah Keefe','Meghan Gonya','Joseph Cumming','Illai Gutierrez','Immanuel Marmol',
  'James Golden','James Marcucci','James Walsh','Jenna Gorman','JJ Bachiochi',
  'John Enriquez','John Nohrden','John Sullivan','Joseph Brennan','JP Golden',
  'Julianna Gutierrez','Kate Worcester','Keira Parrella','Libby Hamel',
  'Lily Nohrden','Livina Vaz','Luke Bachiochi','Michael Gonya','Maeve Walsh',
  'Maggie Arico','Mairead Flynn','Abby Biggins','Marae McCarthy','Maria McQuade',
  'MaryRose Mahoney','Thomas Mahoney','Matthew Brennan','Mia Driscoll','Mia Fiala','Michael Kenney',
  'Michelle Ide','Mitch Finnegan','Nathan Behrmann','Nico Reardon','Noah Crowder',
  'Noelle Watt','Nora Konetzny','Paul Mahoney','Owen Gonet','Paul Haggarty','Penny Awad',
  'Peter Keefe','Reese Masso','Sophia Nicholson','Stella Driscoll','Ted Worcester',
  'Thomas Cleary','Tim Hill','Timmy Brown','Tom Marcucci','Tommy Biggins',
  'Tommy Hamel','Will Enriquez','Will Finnegan','Will Vaccaro','Winnie Subber',
  'Wyatt Subber','Xavier Bogart','Raphael Ide','Gigi Arico','Maria Elena Franchi','Natalia McLaughlin',
  'Cece McLaughlin','Genevieve Nohrden','Catalina Perdomo','Bella Gonet',
  'Ali Hamel','Ella Cronin','Alina Falcao','Paxton Roper','Caterina Franchi',
  'Alex Matiolli','Matt Cunis','Keira Hyatt','MJ Phelps','Mary Marshall',
  'Xavien Crowder','James Kerr','Irena Sabtchev','Paulina Arena','Leah Vaz',
  'Jane Marino','Ali Walsh','Natalie Bowman','Annabell Malow','Claire Olohan',
  'Jonathan Thomas','Mason Connly','Allie Fetter','Charlie Phelps','Jackie Sparks',
  'Keegan Masso','Paul Murphy','Eamon Keefe','Lyla McCarthy','Eli Joanis',
  'Henry Bowman','John Nelson','Lucy Tierney','Sara Johnson','Sarah Flaherty',
  'Caleb Wells','Caroline Kenney','Cece Whallen','Daniel Woods','Kevin Judge',
  'Luke Brown','Nicholas Montalbano','Elizabeth Barrette','Jack Finnegan','Hayley Grinn',
  'Jacky Grinn','Alana Hyatt','Ali Fetter','Andrew DiBartola','Ava Robinson',
  'Ben Vaccarro','Caroline Bernier','Clare Higgins','Dan Warren','Daniel Woodard',
  'Elizabeth Brennan','Gabby Graziano','Henry Awad','Kat Flynn','Logan Conlin',
  'Luli Martinez','Maggie Roche','Midas Videra','Nick Arico','Nora Burke','Olivia Peterson',
  'Shannon Burke','Teddy Robertson','Thomas Behrmann','Victoria Florez','Will Parrella',
  'Anne Marie Nohrden','Aniya Gutierrez'
];

const defaultCore = [
  "Raphael Ide","Gigi Arico","Maria Elena Franchi","Natalia McLaughlin",
  "Cece McLaughlin","Genevieve Nohrden","Catalina Perdomo","Bella Gonet",
  "Ali Hamel","Ella Cronin","Alina Falcao","Paxton Roper"
];

let presentList = [];
let coreList = [];
let tables = [];
let currentMode = 'youth';

/* =========================
   AUTOCOMPLETE
========================= */
function setupAutocomplete(
  inputId,
  suggestionsId,
  selectedId,
  sourceList,
  targetArray,
  withNotes = false
) {
  const input = document.getElementById(inputId);
  const suggestions = document.getElementById(suggestionsId);
  const selected = document.getElementById(selectedId);

  let activeIndex = -1;

  function renderSuggestions() {
    const query = input.value.toLowerCase();
    suggestions.innerHTML = "";

    if (!query) return;

    const matches = sourceList.filter(
      name =>
        name.toLowerCase().includes(query) &&
        !targetArray.some(o => o.name === name)
    );

    matches.forEach((name, index) => {
      const div = document.createElement("div");
      div.className = "suggestion-item";
      div.textContent = name;
      if (index === activeIndex) div.classList.add("active");

      div.onclick = () => selectName(name);
      suggestions.appendChild(div);
    });
  }

  function renderSelected() {
    selected.innerHTML = "";

    targetArray.forEach(obj => {
      const pill = document.createElement("div");
      pill.className = "selected-pill";
      pill.innerHTML = `${obj.name} <span>Ã—</span>`;

      pill.querySelector("span").onclick = () => {
        const name = obj.name;

        // remove from this list
        targetArray.splice(targetArray.indexOf(obj), 1);

        // ðŸ”‘ removing PRESENT also removes CORE
        if (targetArray === presentList) {
          coreList = coreList.filter(c => c.name !== name);
        }

        renderSelected();
        updateCopyList();
      };

      selected.appendChild(pill);

      if (withNotes) {
        const note = document.createElement("textarea");
        note.className = "note-box";
        note.placeholder = "Notes...";
        note.value = obj.notes;
        note.oninput = () => (obj.notes = note.value);
        selected.appendChild(note);
      }
    });

    updateCopyList();
  }

  function selectName(name) {
    if (!targetArray.some(o => o.name === name)) {
      targetArray.push({ name, notes: "" });
    }

    // ðŸ”‘ CORE âŠ† PRESENT
    if (targetArray === coreList) {
      if (!presentList.some(p => p.name === name)) {
        presentList.push({ name, notes: "" });
      }
    }

    input.value = "";
    suggestions.innerHTML = "";
    activeIndex = -1;

    renderSelected();
  }

  input.addEventListener("input", renderSuggestions);

  input.addEventListener("keydown", e => {
    const items = suggestions.querySelectorAll(".suggestion-item");
    if (!items.length) return;

    if (e.key === "ArrowDown") {
      activeIndex = (activeIndex + 1) % items.length;
    }

    if (e.key === "ArrowUp") {
      activeIndex = (activeIndex - 1 + items.length) % items.length;
    }

    if (e.key === "Enter") {
      e.preventDefault();
      if (items[activeIndex]) {
        selectName(items[activeIndex].textContent);
      }
    }

    items.forEach((el, i) =>
      el.classList.toggle("active", i === activeIndex)
    );
  });

  // render defaults immediately
  renderSelected();
}

/* =========================
   COPY LIST
========================= */
function updateCopyList() {
  const lines = [];

  presentList.forEach(p => {
    if (coreList.some(c => c.name === p.name)) {
      lines.push(`${p.name} (CORE)`);
    } else {
      lines.push(p.name);
    }
  });

  document.getElementById("copyList").value = lines.join("\n");
}

/* =========================
   CSV EXPORT
========================= */
function exportToCSV() {
  if(!presentList.length){alert("No attendees selected."); return;}
  const combined = [...presentList];
  let csv="Name,Notes\n";
  combined.forEach(obj=>csv+=`"${obj.name}","${obj.notes||""}"\n`);
  const link=document.createElement("a");
  link.href="data:text/csv;charset=utf-8,"+encodeURI(csv);
  link.download="youth_group_attendees.csv";
  document.body.appendChild(link); link.click(); document.body.removeChild(link);
}

/* =========================
   TABLES
========================= */
function generateTables() {
  const num=parseInt(document.getElementById("numTables").value);
  if(coreList.length<num){alert("You need at least as many core members as tables."); return;}
  tables=Array.from({length:num},()=>[]);

  function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr;}

  const shuffledCore = shuffle(coreList.map(c => c.name));
  for (let i = 0; i < num; i++) tables[i].push(shuffledCore[i]);

  let remaining = presentList
  .map(p => p.name)
  .filter(n => !coreList.some(c => c.name === n));

  const togetherGroups=document.getElementById("togetherGroups").value.split(/\n+/).map(line=>line.split(",").map(p=>p.trim()));

  togetherGroups.forEach(group=>{
    const presentGroup=group.filter(p=>presentList.some(obj=>obj.name===p));
    if(!presentGroup.length) return;
    const coreInGroup = presentGroup.filter(p =>
      coreList.some(c => c.name === p)
    );
    if(coreInGroup.length){
      const anchor=coreInGroup[0];
      let tableIndex=tables.findIndex(t=>t.includes(anchor));
      presentGroup.forEach(p=>{if(!tables[tableIndex].includes(p)) tables[tableIndex].push(p);});
      remaining=remaining.filter(p=>!presentGroup.includes(p));
    } else {
      let tableIndex=tables.reduce((min,t,idx,arr)=>t.length<arr[min].length?idx:min,0);
      tables[tableIndex].push(...presentGroup);
      remaining=remaining.filter(p=>!presentGroup.includes(p));
    }
  });

  remaining=shuffle(remaining);
  let t=0;
  remaining.forEach(p=>{tables[t].push(p); t=(t+1)%num;});
  renderTables();
}

function renderTables() {
  const out=document.getElementById("output");
  out.innerHTML="";
  tables.forEach((tbl,i)=>{
    const div=document.createElement("div"); div.className="table";
    let html=`<h3>Table ${i+1}</h3><ul ondragover="allowDrop(event)" ondrop="drop(event,${i})">`;
    tbl.forEach(p=>html+=`<li draggable="true" ondragstart="drag(event)" data-name="${p}">${p}</li>`);
    html+="</ul>";
    div.innerHTML=html; out.appendChild(div);
  });
}

function drag(ev){ev.dataTransfer.setData("text",ev.target.dataset.name);}
function allowDrop(ev){ev.preventDefault();}
function drop(ev,tableIndex){
  ev.preventDefault();
  const name=ev.dataTransfer.getData("text");
  tables.forEach(t=>{const idx=t.indexOf(name); if(idx!==-1) t.splice(idx,1);});
  tables[tableIndex].push(name); renderTables();
}

/* =========================
   MODE
========================= */
function setMode(mode){
  currentMode=mode;
  document.getElementById("rosaryBtn").classList.toggle("active-mode",mode==="rosary");
  document.getElementById("youthBtn").classList.toggle("active-mode",mode==="youth");
  document.getElementById("youthFeatures").classList.toggle("hidden",mode==="rosary");
}

setupAutocomplete(
  "presentInput",
  "presentSuggestions",
  "presentSelected",
  allAttendees,
  presentList,
  true
);

setupAutocomplete(
  "coreInput",
  "coreSuggestions",
  "coreSelected",
  allAttendees,
  coreList,
  true
);

</script>
</body>
</html>
