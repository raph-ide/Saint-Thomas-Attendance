<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Saint Thomas Attendance</title>

<style>
/* =========================
   GLOBAL
========================= */
* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: radial-gradient(circle at top, rgba(122, 180, 255, 0.25), transparent 55%),
    linear-gradient(#f5f5f7, #ffffff);
  color: #1c1c1e;
  margin: 0;
  padding: 24px;
  max-width: 1100px;
  margin-inline: auto;
  line-height: 1.5;
}

/* =========================
   TYPOGRAPHY
========================= */
h1 {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
}

h1 span {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: #6e6e73;
  margin-top: 6px;
}

h3 {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 12px;
  color: #3a3a3c;
}

.page-header {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 24px;
}

.header-subtitle {
  font-size: 15px;
  color: #5a5a5f;
  margin: 0;
}

/* =========================
   CARDS
========================= */
.card {
  background: white;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 24px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
  border: 1px solid rgba(0, 0, 0, 0.04);
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.helper-text {
  margin: 0 0 12px;
  font-size: 13px;
  color: #6e6e73;
}

/* =========================
   INPUTS
========================= */
input, textarea, button {
  font-family: inherit;
}

input, textarea {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #d1d1d6;
  font-size: 15px;
}

input:focus, textarea:focus {
  outline: none;
  border-color: #007aff;
}

input:focus-visible, textarea:focus-visible, button:focus-visible {
  outline: 2px solid #007aff;
  outline-offset: 2px;
}

/* =========================
   BUTTONS
========================= */
button {
  padding: 12px 16px;
  border-radius: 14px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  background-color: #007aff;
  color: white;
  box-shadow: 0 6px 14px rgba(0,122,255,0.25);
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

button:hover { transform: translateY(-1px); }
button:active {
  transform: translateY(1px);
  box-shadow: 0 3px 8px rgba(0,122,255,0.25);
}

button.secondary {
  background: #28a745;
  box-shadow: 0 6px 14px rgba(40,167,69,0.25);
}

.field-label {
  display: block;
  margin-bottom: 6px;
  font-size: 13px;
  font-weight: 600;
  color: #5a5a5f;
}

/* =========================
   DARK MODE
========================= */
body.dark-mode {
  background: linear-gradient(#1c1c1e, #000);
  color: #f2f2f7; /* ðŸ”‘ makes MOST text white */
}

/* Headings */
body.dark-mode h1,
body.dark-mode h3 {
  color: #f2f2f7;
}

/* Cards */
body.dark-mode .card {
  background: #2c2c2e;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  border-color: rgba(255, 255, 255, 0.08);
}

/* Inputs & textareas */
body.dark-mode input,
body.dark-mode textarea {
  background: #1c1c1e;
  color: #f2f2f7;
  border-color: #3a3a3c;
}

/* Buttons */
body.dark-mode button {
  background-color: #0a84ff;
}

/* Secondary button */
body.dark-mode button.secondary {
  background-color: #30d158;
}

/* Autocomplete suggestions */
body.dark-mode .suggestions {
  background: #2c2c2e;
}

body.dark-mode .suggestion-item {
  color: #f2f2f7;
}

body.dark-mode .suggestion-item:hover,
body.dark-mode .suggestion-item.active {
  background: #3a3a3c;
}

/* Selected pills */
body.dark-mode .selected-pill {
  background: #3a3a3c;
  border-color: #48484a;
}

body.dark-mode .selected-pill span {
  color: #ff453a;
}

/* Tables */
body.dark-mode .table {
  background: #2c2c2e;
}

body.dark-mode li {
  background: #1c1c1e;
  color: #f2f2f7;
  border-color: #3a3a3c;
}

/* Footer */
body.dark-mode .footer-text {
  color: #8e8e93;
}

body.dark-mode h1 span {
  color: #8e8e93;
}

body.dark-mode .header-subtitle,
body.dark-mode .helper-text,
body.dark-mode .field-label {
  color: #b0b0b5;
}

/* =========================
   MODE TOGGLE
========================= */
.mode-buttons {
  display: flex;
  gap: 6px;
  background: #f2f2f7;
  padding: 6px;
  border-radius: 999px;
  margin-bottom: 24px;
}

.toolbar {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  margin-bottom: 24px;
  padding: 12px 16px;
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.7);
  border: 1px solid rgba(0, 0, 0, 0.05);
  box-shadow: 0 8px 16px rgba(0,0,0,0.06);
}

.toggle-button {
  background: white;
  color: #007aff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  border: 1px solid rgba(0, 0, 0, 0.06);
}

.toggle-button.dark-on {
  background: #1c1c1e;
  color: #f2f2f7;
}

.mode-button {
  flex: 1;
  background: transparent;
  color: #3a3a3c;
  box-shadow: none;
}

.mode-button.active-mode {
  background: white;
  color: #007aff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* =========================
   AUTOCOMPLETE
========================= */
.autocomplete-box { position: relative; }

.suggestions {
  position: absolute;
  width: 100%;
  margin-top: 6px;
  background: white;
  border-radius: 12px;
  max-height: 180px;
  overflow-y: auto;
  box-shadow: 0 10px 25px rgba(0,0,0,0.12);
  z-index: 20;
  border: 1px solid rgba(0,0,0,0.08);
}

.suggestion-item {
  padding: 10px 12px;
  cursor: pointer;
}

.suggestion-item:hover,
.suggestion-item.active {
  background: #e9f2ff;
}

/* =========================
   SELECTED PILLS
========================= */
.selected-pill {
  display: inline-block;
  padding: 6px 12px;
  margin: 4px;
  border-radius: 20px;
  background: #f2f2f7;
  border: 1px solid #d1d1d6;
}

.selected-pill span {
  margin-left: 8px;
  color: #ff3b30;
  cursor: pointer;
  font-weight: bold;
}

.note-box {
  width: 100%;
  margin: 6px 0 12px;
  padding: 8px;
  border-radius: 10px;
  border: 1px solid #d1d1d6;
  resize: vertical;
  transition: max-height 0.2s ease, opacity 0.2s ease;
}

.note-box.collapsed {
  max-height: 0;
  opacity: 0;
  padding: 0;
  margin: 0;
  border: 0;
  overflow: hidden;
  pointer-events: none;
}

.note-toggle {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  margin: 4px 0 10px;
  border-radius: 50%;
  border: 1px solid #d1d1d6;
  background: #f2f2f7;
  color: #3a3a3c;
  font-size: 14px;
  cursor: pointer;
  box-shadow: none;
  padding: 0;
}

.note-toggle:hover {
  background: #e5e5ea;
  transform: none;
  box-shadow: none;
}

body.dark-mode .note-toggle {
  background: #3a3a3c;
  border-color: #48484a;
  color: #f2f2f7;
}

body.dark-mode .note-toggle:hover {
  background: #48484a;
}

/* =========================
   TABLES
========================= */
#output {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap: 16px;
  margin-top: 16px;
}

.table {
  background: white;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.06);
  border: 1px solid rgba(0, 0, 0, 0.05);
}

.table h3 {
  margin-top: 0;
  border-bottom: 1px solid #e5e5ea;
  padding-bottom: 8px;
}

li {
  list-style: none;
  padding: 8px 10px;
  margin: 6px 0;
  border: 1px solid #e5e5ea;
  border-radius: 8px;
  cursor: grab;
  background: #fff;
}

/* ========================= */
.hidden { display: none; }
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}
.footer-text {
  margin-top: 40px;
  font-size: 12px;
  color: #6e6e73;
  text-align: center;
}

.live-counter {
  margin-bottom: 12px;
  font-size: 14px;
  color: #3a3a3c;
  display: flex;
  gap: 16px;
  font-weight: 600;
}

body.dark-mode .live-counter {
  color: #d1d1d6;
}

body.dark-mode .toolbar {
  background: rgba(44, 44, 46, 0.9);
  border-color: rgba(255, 255, 255, 0.08);
}

body.dark-mode .mode-buttons {
  background: #3a3a3c;
}

body.dark-mode .suggestion-item:hover,
body.dark-mode .suggestion-item.active {
  background: #2f4b76;
}

</style>
</head>

<body>

<header class="page-header">
  <h1>Saint Thomas Youth Group Attendance <span>Track attendance, tables, and notes</span></h1>
</header>

<div class="toolbar">
  <div class="mode-buttons" role="group" aria-label="Select attendance mode">
    <button type="button" id="rosaryBtn" class="mode-button" onclick="setMode('rosary')">Rosary / Holy Hour</button>
    <button type="button" id="youthBtn" class="mode-button active-mode" onclick="setMode('youth')">Youth Group</button>
  </div>

  <button type="button" id="darkModeBtn" class="toggle-button" onclick="toggleDarkMode()" aria-pressed="false">Enable Dark Mode</button>
</div>

<div class="card">
  <div class="card-header">
    <h3>Present Attendees</h3>
  </div>
  <div class="autocomplete-box">
    <label class="field-label" for="presentInput">Add present attendee</label>
    <input id="presentInput" placeholder="Type a name..." autocomplete="off" aria-autocomplete="list" aria-controls="presentSuggestions">
    <div id="presentSuggestions" class="suggestions" role="listbox"></div>
  </div>
  <div id="presentSelected"></div>
</div>

<div id="youthFeatures">

  <div class="card">
    <div class="card-header">
      <h3>Core Members</h3>
    </div>
    <div class="autocomplete-box">
      <label class="field-label" for="coreInput">Add core member</label>
      <input id="coreInput" placeholder="Type a core member..." autocomplete="off" aria-autocomplete="list" aria-controls="coreSuggestions">
      <div id="coreSuggestions" class="suggestions" role="listbox"></div>
    </div>
    <div id="coreSelected"></div>
  </div>

  <div class="card">
    <div class="card-header">
      <h3>Groups That Must Sit Together</h3>
    </div>
    <label class="field-label" for="togetherGroups">Group list</label>
    <textarea id="togetherGroups" placeholder="One group per line: Name, Name, Name"></textarea>

    <h3>Number of Tables</h3>
    <label class="field-label" for="numTables">Total tables</label>
    <input type="number" id="numTables" min="1" value="8">

    <br><br>
    <button type="button" onclick="generateTables()">Generate Tables</button>

    <div id="output"></div>
  </div>

</div>

<div class="card">
  <div class="card-header">
    <h3>Attendance List</h3>
  </div>

  <!-- LIVE COUNTER -->
  <div id="liveCounter" class="live-counter" aria-live="polite"></div>

  <label class="field-label" for="copyList">Attendance output</label>
  <textarea id="copyList" rows="8" placeholder="Marked attendees will appear here..."></textarea>
  <br><br>
  <button type="button" class="secondary" onclick="exportToCSV()">Export to CSV</button>
</div>

<div class="footer-text">
  Â© 2026 Saint Thomas the Apostle Youth Group Â· Raphael Ide
</div>

<div class="footer-text">
   Click <a href="https://files.ecatholic.com/20819/documents/2026/1/Top%2050%20Point%20Scorers-1.pdf?t=1769015516000">here</a> to see the current point standings!!
</div>

<script>
/* =========================
   DATA
========================= */
const allAttendees = [
  'Mara Wesolowski','Allie Choate','Bria Santoro','MariaTeresa Arena',
  'Danny Kuyrouz','Amelia Cannato','Carmine Arena','Francesco Arena',
  'Winnie McLaughlin','Caroline Lally','Luke Walsh','Flynn Walsh','James Bowman',
  'Emmie Valenzuela','Antony Marcucci','Maggie Woodard','Amelia Choate',
  'Andrew Foraker','Bella Calvo','Ben Biggins','Blake Masso','Will OBrien',
  'Bridget Gonya','Caroline Gonya','Bowman Rhinesmith','Cat Choate','Catalina Calvo',
  'Catarina Franchi','Catherine McLaughlin','Cecelia Lateo','Charbel Almacari',
  'Charlotte Keefe','Christine Cheely','Sammy Biggins','Clare Walsh','Cormac Doyle',
  'Dermot O\'Boyle','Dottie Mahoney','Kaylee Cumming','Elizabeth Brown','Ella Hill',
  'Emilia Parrella','Emily Rameaka','Owen Rameaka','Grace Ahearn','Grace Finnegan',
  'Grace Garvey','Grace Lynch','Graham Evans','Nicholas Arico','Grace Nohrden','Griffin Masso',
  'Hannah Keefe','Meghan Gonya','Joseph Cumming','Illai Gutierrez','Immanuel Marmol',
  'James Golden','James Marcucci','James Walsh','Jenna Gorman','JJ Bachiochi',
  'John Enriquez','John Nohrden','John Sullivan','Joseph Brennan','JP Golden',
  'Julianna Gutierrez','Kate Worcester','Keira Parrella','Libby Hamel',
  'Lily Nohrden','Livina Vaz','Luke Bachiochi','Michael Gonya','Maeve Walsh',
  'Maggie Arico','Mairead Flynn','Abby Biggins','Marae McCarthy','Maria McQuade',
  'MaryRose Mahoney','Thomas Mahoney','Matthew Brennan','Mia Driscoll','Mia Fiala','Michael Kenney',
  'Michelle Ide','Mitch Finnegan','Nathan Behrmann','Nico Reardon','Noah Crowder',
  'Noelle Watt','Nora Konetzny','Paul Mahoney','Owen Gonet','Paul Haggarty','Penny Awad',
  'Peter Keefe','Reese Masso','Sophia Nicholson','Stella Driscoll','Ted Worcester',
  'Thomas Cleary','Tim Hill','Timmy Brown','Tom Marcucci','Tommy Biggins',
  'Tommy Hamel','Will Enriquez','Will Finnegan','Will Vaccaro','Winnie Subber',
  'Wyatt Subber','Xavier Bogart','Raphael Ide','Gigi Arico','Maria Elena Franchi','Natalia McLaughlin',
  'Cece McLaughlin','Genevieve Nohrden','Catalina Perdomo','Bella Gonet',
  'Ali Hamel','Ella Cronin','Alina Falcao','Paxton Roper','Caterina Franchi',
  'Alex Matiolli','Matt Cunis','Keira Hyatt','MJ Phelps','Mary Marshall',
  'Xavien Crowder','James Kerr','Irena Sabtchev','Paulina Arena','Leah Vaz',
  'Jane Marino','Ali Walsh','Natalie Bowman','Annabell Malow','Claire Olohan',
  'Jonathan Thomas','Mason Connly','Allie Fetter','Charlie Phelps','Jackie Sparks',
  'Keegan Masso','Paul Murphy','Eamon Keefe','Lyla McCarthy','Eli Joanis',
  'Henry Bowman','John Nelson','Lucy Tierney','Sara Johnson','Sarah Flaherty',
  'Caleb Wells','Caroline Kenney','Cece Whallen','Daniel Woods','Kevin Judge',
  'Luke Brown','Nicholas Montalbano','Elizabeth Barrette','Jack Finnegan','Hayley Grinn',
  'Jacky Grinn','Alana Hyatt','Ali Fetter','Andrew DiBartola','Ava Robinson',
  'Ben Vaccarro','Caroline Bernier','Clare Higgins','Dan Warren','Daniel Woodard',
  'Elizabeth Brennan','Gabby Graziano','Henry Awad','Kat Flynn','Logan Conlin',
  'Luli Martinez','Maggie Roche','Midas Videra','Nick Arico','Nora Burke','Olivia Peterson',
  'Shannon Burke','Teddy Robertson','Thomas Behrmann','Victoria Florez','Will Parrella',
  'Anne Marie Nohrden','Aniya Gutierrez'
];

const defaultCore = [
  "Raphael Ide","Gigi Arico","Maria Elena Franchi","Natalia McLaughlin",
  "Cece McLaughlin","Genevieve Nohrden","Catalina Perdomo","Bella Gonet",
  "Ali Hamel","Ella Cronin","Alina Falcao","Paxton Roper"
];

let presentList = [];
let coreList = [];
let tables = [];
let currentMode = 'youth';

/* =========================
   AUTOCOMPLETE
========================= */
function setupAutocomplete(
  inputId,
  suggestionsId,
  selectedId,
  sourceList,
  targetArray,
  withNotes = false
) {
  const input = document.getElementById(inputId);
  const suggestions = document.getElementById(suggestionsId);
  const selected = document.getElementById(selectedId);

  let activeIndex = -1;
  input.setAttribute("aria-expanded", "false");

  function renderSuggestions() {
    const query = input.value.toLowerCase();
    suggestions.innerHTML = "";

    if (!query) {
      input.setAttribute("aria-expanded", "false");
      return;
    }

    const matches = sourceList.filter(
      name =>
        name.toLowerCase().includes(query) &&
        !targetArray.some(o => o.name === name)
    );

    matches.forEach((name, index) => {
      const div = document.createElement("div");
      div.className = "suggestion-item";
      div.setAttribute("role", "option");
      div.setAttribute("aria-selected", index === activeIndex ? "true" : "false");
      div.textContent = name;
      if (index === activeIndex) div.classList.add("active");

      div.onclick = () => selectName(name);
      suggestions.appendChild(div);
    });

    input.setAttribute("aria-expanded", matches.length ? "true" : "false");
  }

  function renderSelected() {
    selected.innerHTML = "";

    targetArray.forEach(obj => {
      const pill = document.createElement("div");
      pill.className = "selected-pill";
      pill.innerHTML = `${obj.name} <span>Ã—</span>`;

      pill.querySelector("span").onclick = () => {
        const name = obj.name;

        // remove from this list
        targetArray.splice(targetArray.indexOf(obj), 1);

        // ðŸ”‘ removing PRESENT also removes CORE
        if (targetArray === presentList) {
          coreList = coreList.filter(c => c.name !== name);
        }

        renderSelected();
        updateCopyList();
      };

      selected.appendChild(pill);

      if (withNotes) {
        const toggle = document.createElement("button");
        toggle.type = "button";
        toggle.className = "note-toggle";
        toggle.setAttribute("aria-label", "Toggle notes");
        toggle.textContent = "â–¶";

        const note = document.createElement("textarea");
        note.className = "note-box collapsed";
        note.placeholder = "Notes...";
        note.value = obj.notes;
        const setExpanded = expanded => {
          note.classList.toggle("collapsed", !expanded);
          toggle.textContent = expanded ? "â–¼" : "â–¶";
        };

        toggle.addEventListener("click", () => {
          const isCollapsed = note.classList.contains("collapsed");
          setExpanded(isCollapsed);
          if (isCollapsed) {
            note.focus();
          }
        });

        note.addEventListener("input", () => {
          obj.notes = note.value;
        });

        setExpanded(false);
        selected.appendChild(toggle);
        selected.appendChild(note);
      }
    });

    updateCopyList();
  }

  function selectName(name) {
    if (!targetArray.some(o => o.name === name)) {
      targetArray.push({ name, notes: "" });
    }

    // ðŸ”‘ CORE âŠ† PRESENT
    if (targetArray === coreList) {
      if (!presentList.some(p => p.name === name)) {
        presentList.push({ name, notes: "" });
      }
    }

    input.value = "";
    suggestions.innerHTML = "";
    input.setAttribute("aria-expanded", "false");
    activeIndex = -1;

    renderSelected();
  }

  input.addEventListener("input", renderSuggestions);

  input.addEventListener("blur", () => {
    setTimeout(() => {
      suggestions.innerHTML = "";
      input.setAttribute("aria-expanded", "false");
      activeIndex = -1;
    }, 100);
  });

  input.addEventListener("keydown", e => {
    const items = suggestions.querySelectorAll(".suggestion-item");
    if (e.key === "Escape") {
      suggestions.innerHTML = "";
      input.setAttribute("aria-expanded", "false");
      activeIndex = -1;
      return;
    }

    if (!items.length) return;

    if (e.key === "ArrowDown") {
      activeIndex = (activeIndex + 1) % items.length;
    }

    if (e.key === "ArrowUp") {
      activeIndex = (activeIndex - 1 + items.length) % items.length;
    }

    if (e.key === "Enter") {
      e.preventDefault();
      if (items[activeIndex]) {
        selectName(items[activeIndex].textContent);
      }
    }

    items.forEach((el, i) =>
      el.classList.toggle("active", i === activeIndex)
    );

    items.forEach((el, i) =>
      el.setAttribute("aria-selected", i === activeIndex ? "true" : "false")
    );
  });

  // render defaults immediately
  renderSelected();
}

/* =========================
   COPY LIST
========================= */
function updateCopyList() {
  const lines = [];

  presentList.forEach(p => {
    if (coreList.some(c => c.name === p.name)) {
      lines.push(`${p.name} (CORE)`);
    } else {
      lines.push(p.name);
    }
  });

  document.getElementById("copyList").value = lines.join("\n");
  updateLiveCounter();
}

/* =========================
   LIVE COUNTER
========================= */
function updateLiveCounter() {
  const presentCount = presentList.length;
  const coreCount = coreList.length;
  const tableCount = tables.length;

  const counter = document.getElementById("liveCounter");
  counter.textContent = `Present: ${presentCount}  |  Core: ${coreCount}  |  Tables: ${tableCount}`;
}

/* =========================
   CSV EXPORT
========================= */
function exportToCSV() {
  if(!presentList.length){alert("No attendees selected."); return;}
  const combined = [...presentList];
  const escapeField = value => `"${String(value).replace(/"/g, '""')}"`;
  let csv="Name,Notes\n";
  combined.forEach(obj=>csv+=`${escapeField(obj.name)},${escapeField(obj.notes||"")}\n`);
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.download="youth_group_attendees.csv";
  document.body.appendChild(link); link.click(); document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
}

/* =========================
   TABLES
========================= */
function generateTables() {
  const num=parseInt(document.getElementById("numTables").value);
  if(coreList.length<num){alert("You need at least as many core members as tables."); return;}
  tables=Array.from({length:num},()=>[]);

  function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr;}

  const shuffledCore = shuffle(coreList.map(c => c.name));
  for (let i = 0; i < num; i++) tables[i].push(shuffledCore[i]);

  let remaining = presentList
  .map(p => p.name)
  .filter(n => !coreList.some(c => c.name === n));

  const togetherGroups=document.getElementById("togetherGroups").value.split(/\n+/).map(line=>line.split(",").map(p=>p.trim()));

  togetherGroups.forEach(group=>{
    const presentGroup=group.filter(p=>presentList.some(obj=>obj.name===p));
    if(!presentGroup.length) return;
    const coreInGroup = presentGroup.filter(p =>
      coreList.some(c => c.name === p)
    );
    if(coreInGroup.length){
      const anchor=coreInGroup[0];
      let tableIndex=tables.findIndex(t=>t.includes(anchor));
      presentGroup.forEach(p=>{if(!tables[tableIndex].includes(p)) tables[tableIndex].push(p);});
      remaining=remaining.filter(p=>!presentGroup.includes(p));
    } else {
      let tableIndex=tables.reduce((min,t,idx,arr)=>t.length<arr[min].length?idx:min,0);
      tables[tableIndex].push(...presentGroup);
      remaining=remaining.filter(p=>!presentGroup.includes(p));
    }
  });

  remaining=shuffle(remaining);
  let t=0;
  remaining.forEach(p=>{tables[t].push(p); t=(t+1)%num;});
  renderTables();
  updateLiveCounter();
}

function renderTables() {
  const out=document.getElementById("output");
  out.innerHTML="";
  tables.forEach((tbl,i)=>{
    const div=document.createElement("div"); div.className="table";
    let html=`<h3>Table ${i+1}</h3><ul ondragover="allowDrop(event)" ondrop="drop(event,${i})">`;
    tbl.forEach(p=>html+=`<li draggable="true" ondragstart="drag(event)" data-name="${p}">${p}</li>`);
    html+="</ul>";
    div.innerHTML=html; out.appendChild(div);
  });
}

function drag(ev){ev.dataTransfer.setData("text",ev.target.dataset.name);}
function allowDrop(ev){ev.preventDefault();}
function drop(ev,tableIndex){
  ev.preventDefault();
  const name=ev.dataTransfer.getData("text");
  tables.forEach(t=>{const idx=t.indexOf(name); if(idx!==-1) t.splice(idx,1);});
  tables[tableIndex].push(name); renderTables(); updateLiveCounter();
}

/* =========================
   MODE
========================= */
function setMode(mode){
  currentMode=mode;
  document.getElementById("rosaryBtn").classList.toggle("active-mode",mode==="rosary");
  document.getElementById("youthBtn").classList.toggle("active-mode",mode==="youth");
  document.getElementById("youthFeatures").classList.toggle("hidden",mode==="rosary");
}

setupAutocomplete(
  "presentInput",
  "presentSuggestions",
  "presentSelected",
  allAttendees,
  presentList,
  true
);

setupAutocomplete(
  "coreInput",
  "coreSuggestions",
  "coreSelected",
  allAttendees,
  coreList,
  true
);

function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
  const button = document.getElementById("darkModeBtn");
  const isDark = document.body.classList.contains("dark-mode");
  button.classList.toggle("dark-on", isDark);
  button.setAttribute("aria-pressed", isDark ? "true" : "false");
  button.textContent = isDark ? "Disable Dark Mode" : "Enable Dark Mode";
}

</script>
</body>
</html>
